# ì‹¤ì‹œê°„ ê°€ìƒ í”¼íŒ… ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

## ğŸ“Œ ê°œìš”
ìº¡ì²˜ëœ ì‚¬ì§„ì´ ì•„ë‹Œ **ì‹¤ì‹œê°„ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼**ìœ¼ë¡œ ê°€ìƒ í”¼íŒ…ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
- ì‹¤ì‹œê°„ í¬ì¦ˆ ì¶”ì  (MediaPipe)
- ì˜· ë°°ê²½ ìë™ ì œê±°
- ê´€ì ˆ ìœ„ì¹˜ ê¸°ë°˜ ì˜· ì˜¤ë²„ë ˆì´
- í”„ë¡ íŠ¸ì—”ë“œ ì‹¤ì‹œê°„ í‘œì‹œ

---

## ğŸ—‚ï¸ ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼

### 1. `back/fit/cloth_processor.py`
ì˜· ì´ë¯¸ì§€ ì²˜ë¦¬ ëª¨ë“ˆ
- **remove_background()**: ì˜· ë°°ê²½ì„ íˆ¬ëª…í•˜ê²Œ ì œê±° (rembg ì‚¬ìš©)
- **resize_cloth_to_body()**: ì‹ ì²´ í¬ê¸°ì— ë§ê²Œ ì˜· ë¦¬ì‚¬ì´ì¦ˆ
- **overlay_cloth_on_body()**: í”„ë ˆì„ì— ì˜· ì˜¤ë²„ë ˆì´ (ì•ŒíŒŒ ë¸”ë Œë”©)

### 2. `back/fit/virtual_fitting.py`
ì‹¤ì‹œê°„ ê°€ìƒ í”¼íŒ… ë©”ì¸ ë¡œì§
- **VirtualFitting í´ë˜ìŠ¤**: ì‹¤ì‹œê°„ ì²˜ë¦¬ ë‹´ë‹¹
- **calculate_body_metrics()**: ì–´ê¹¨ ë„ˆë¹„, ìƒì²´ ë†’ì´ ê³„ì‚°
- **process_frame()**: ê° í”„ë ˆì„ë§ˆë‹¤ ì˜· ì…íˆê¸°
- **run_webcam()**: ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥ (í…ŒìŠ¤íŠ¸ìš©)

### 3. `back/routes/clothes.py` (ì¶”ê°€)
ì‹¤ì‹œê°„ API ì—”ë“œí¬ì¸íŠ¸
- **POST /api/fit/stream**: í”„ë ˆì„ ë°›ì•„ì„œ ì²˜ë¦¬ í›„ ë°˜í™˜
- **POST /api/fit/upload-cloth**: ì˜· ì´ë¯¸ì§€ ì—…ë¡œë“œ

---

## ğŸ”§ í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜

### ë°±ì—”ë“œ Python íŒ¨í‚¤ì§€
```powershell
# ê°€ìƒí™˜ê²½ í™œì„±í™”
.venv312\Scripts\Activate.ps1

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install rembg
pip install mediapipe
pip install opencv-python
pip install pillow
```

---

## ğŸ¯ ë™ì‘ ì›ë¦¬

### 1ë‹¨ê³„: ì˜· ì´ë¯¸ì§€ ì¤€ë¹„
```
input/cloth.jpg (ì˜· ì‚¬ì§„)
    â†“
ë°°ê²½ ì œê±° (rembg)
    â†“
output/cloth_nobg.png (íˆ¬ëª… ë°°ê²½)
```

### 2ë‹¨ê³„: ì‹¤ì‹œê°„ í¬ì¦ˆ ì¶”ì 
```
ì›¹ìº  í”„ë ˆì„
    â†“
MediaPipe Pose ê°ì§€
    â†“
33ê°œ ëœë“œë§ˆí¬ ì¶”ì¶œ
    â†“
ì–´ê¹¨ ì¤‘ì‹¬, ë„ˆë¹„, ìƒì²´ ë†’ì´ ê³„ì‚°
```

### 3ë‹¨ê³„: ì˜· ì˜¤ë²„ë ˆì´
```
ì‹ ì²´ ì¹˜ìˆ˜ ê³„ì‚°
    â†“
ì˜· ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ
    â†“
ì–´ê¹¨ ì¤‘ì‹¬ ìœ„ì¹˜ì— ë°°ì¹˜
    â†“
ì•ŒíŒŒ ë¸”ë Œë”©ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í•©ì„±
    â†“
ìŠ¤ì¼ˆë ˆí†¤ ê·¸ë¦¬ê¸° (ì„ íƒ)
```

---

## ğŸ“¡ API ì‚¬ìš©ë²•

### 1. ì˜· ì´ë¯¸ì§€ ì—…ë¡œë“œ
```javascript
const response = await fetch('/api/fit/upload-cloth', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        image: base64ImageData  // ì˜· ì´ë¯¸ì§€ (Base64)
    })
});
```

### 2. ì‹¤ì‹œê°„ í”„ë ˆì„ ì²˜ë¦¬
```javascript
const response = await fetch('/api/fit/stream', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        frame: base64FrameData,  // ë¹„ë””ì˜¤ í”„ë ˆì„ (Base64)
        showSkeleton: true       // ìŠ¤ì¼ˆë ˆí†¤ í‘œì‹œ ì—¬ë¶€
    })
});

const result = await response.json();
// result.frame: ì²˜ë¦¬ëœ í”„ë ˆì„ (Base64)
```

---

## ğŸ–¥ï¸ ë…ë¦½ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸ìš©)

ì›¹ ì—†ì´ ë°”ë¡œ ì‹¤í–‰ ê°€ëŠ¥:
```powershell
cd C:\Users\parkj\Desktop\Smart_Closet\back\fit
python virtual_fitting.py
```

**í‚¤ ì¡°ì‘:**
- `s`: ìŠ¤ì¼ˆë ˆí†¤ ON/OFF
- `q`: ì¢…ë£Œ

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
back/fit/
â”œâ”€â”€ input/
â”‚   â”œâ”€â”€ cloth.jpg           # ì˜· ì›ë³¸ ì´ë¯¸ì§€
â”‚   â””â”€â”€ model.jpg          # (ì´ì „ ë°©ì‹ìš©)
â”œâ”€â”€ output/
â”‚   â””â”€â”€ cloth_nobg.png     # ë°°ê²½ ì œê±°ëœ ì˜· ì´ë¯¸ì§€ (ìë™ ìƒì„±)
â”œâ”€â”€ cloth_mask.py          # ìƒë°˜ì‹  ë§ˆìŠ¤í¬ ìƒì„± (ê¸°ì¡´)
â”œâ”€â”€ cloth_processor.py     # ì˜· ì²˜ë¦¬ ëª¨ë“ˆ (ì‹ ê·œ)
â”œâ”€â”€ virtual_fitting.py     # ê°€ìƒ í”¼íŒ… ë©”ì¸ (ì‹ ê·œ)
â””â”€â”€ main.py               # ì´ì „ ë°©ì‹ (ì •ì  ì´ë¯¸ì§€)
```

---

## ğŸ¨ ì£¼ìš” íŒŒë¼ë¯¸í„°

### VirtualFitting í´ë˜ìŠ¤
```python
VirtualFitting(
    cloth_image_path='input/cloth.jpg'  # ì˜· ì´ë¯¸ì§€ ê²½ë¡œ
)
```

### process_frame() ë©”ì„œë“œ
```python
process_frame(
    frame,                  # ì…ë ¥ í”„ë ˆì„ (BGR)
    show_skeleton=True      # ìŠ¤ì¼ˆë ˆí†¤ í‘œì‹œ
)
```

### ì˜· í¬ê¸° ì¡°ì •
```python
shoulder_width * 1.2   # ì–´ê¹¨ë³´ë‹¤ 20% í¬ê²Œ
body_height * 1.5      # ìƒì²´ ë†’ì´ì˜ 1.5ë°°
```

### ì˜¤ë²„ë ˆì´ ìœ„ì¹˜
```python
cloth_position = (
    shoulder_center_x,      # X: ì–´ê¹¨ ì¤‘ì‹¬
    shoulder_center_y - 20  # Y: ì–´ê¹¨ë³´ë‹¤ 20px ìœ„
)
```

---

## ğŸš€ í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ì˜ˆì‹œ

```javascript
// ë¹„ë””ì˜¤ ìº¡ì²˜
const canvas = document.createElement('canvas');
canvas.width = video.videoWidth;
canvas.height = video.videoHeight;
const ctx = canvas.getContext('2d');
ctx.drawImage(video, 0, 0);

// Base64ë¡œ ë³€í™˜
const frameData = canvas.toDataURL('image/jpeg', 0.8);

// ì„œë²„ë¡œ ì „ì†¡
const response = await fetch('/api/fit/stream', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        frame: frameData,
        showSkeleton: true
    })
});

const result = await response.json();

// ì²˜ë¦¬ëœ ì´ë¯¸ì§€ í‘œì‹œ
video.src = result.frame;
```

---

## ğŸ” MediaPipe ëœë“œë§ˆí¬

ì‚¬ìš©ë˜ëŠ” ì£¼ìš” ëœë“œë§ˆí¬:
- **LEFT_SHOULDER** (11): ì™¼ìª½ ì–´ê¹¨
- **RIGHT_SHOULDER** (12): ì˜¤ë¥¸ìª½ ì–´ê¹¨
- **LEFT_HIP** (23): ì™¼ìª½ ê³¨ë°˜
- **RIGHT_HIP** (24): ì˜¤ë¥¸ìª½ ê³¨ë°˜

ê³„ì‚°:
```python
shoulder_center = (left_shoulder + right_shoulder) / 2
shoulder_width = abs(right_shoulder.x - left_shoulder.x)
body_height = abs(hip_center.y - shoulder_center.y)
```

---

## âš™ï¸ ì„±ëŠ¥ ìµœì í™”

1. **ëª¨ë¸ ë³µì¡ë„**: `model_complexity=1` (ì‹¤ì‹œê°„ìš©)
2. **JPEG í’ˆì§ˆ**: `85%` (ì†ë„ì™€ í’ˆì§ˆ ê· í˜•)
3. **ì‹±ê¸€í†¤ íŒ¨í„´**: VirtualFitting ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©
4. **ì¢Œìš° ë°˜ì „**: ê±°ìš¸ íš¨ê³¼ (`cv2.flip(frame, 1)`)

---

## ğŸ› ë¬¸ì œ í•´ê²°

### 1. rembg ì„¤ì¹˜ ì˜¤ë¥˜
```powershell
pip install --upgrade pip
pip install rembg
```

### 2. ì˜·ì´ ë„ˆë¬´ ì‘ê²Œ/í¬ê²Œ ë‚˜ì˜´
`virtual_fitting.py`ì—ì„œ ì¡°ì •:
```python
shoulder_width * 1.2  # ì´ ê°’ ì¡°ì • (1.0 ~ 1.5)
body_height * 1.5     # ì´ ê°’ ì¡°ì • (1.2 ~ 2.0)
```

### 3. ì˜· ìœ„ì¹˜ê°€ ì•ˆ ë§ìŒ
`virtual_fitting.py`ì—ì„œ ì¡°ì •:
```python
shoulder_center_y - 20  # ì´ ê°’ ì¡°ì • (-50 ~ 50)
```

### 4. ë°°ê²½ ì œê±° ì‹¤íŒ¨
- ì˜· ì´ë¯¸ì§€ ë°°ê²½ì„ ë‹¨ìƒ‰ìœ¼ë¡œ ë³€ê²½
- ë˜ëŠ” ë°°ê²½ ì œê±° ì—†ì´ ì‚¬ìš© (íˆ¬ëª…ë„ ë‚®ì¶¤)

---

## ğŸ“Š ë‹¤ìŒ ë‹¨ê³„ (ì„ íƒì  ê°œì„ )

1. **WebSocket**: HTTP ëŒ€ì‹  WebSocketìœ¼ë¡œ ì§€ì—° ì‹œê°„ ê°ì†Œ
2. **GPU ê°€ì†**: CUDA í™œì„±í™”ë¡œ ì²˜ë¦¬ ì†ë„ í–¥ìƒ
3. **ì—¬ëŸ¬ ì˜·**: ì˜· ì¢…ë¥˜ë³„ë¡œ ë‹¤ë¥¸ ìœ„ì¹˜/í¬ê¸° ì ìš©
4. **ìë™ ì¡°ì •**: AIë¡œ ì˜· í¬ê¸°/ìœ„ì¹˜ ìë™ ìµœì í™”
5. **ê·¸ë¦¼ì íš¨ê³¼**: ë” ì‚¬ì‹¤ì ì¸ í•©ì„±

---

## âœ… í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `pip install rembg mediapipe opencv-python pillow` ì„¤ì¹˜ ì™„ë£Œ
- [ ] `input/cloth.jpg` íŒŒì¼ ì¡´ì¬ í™•ì¸
- [ ] `python virtual_fitting.py` ë…ë¦½ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
- [ ] ë°±ì—”ë“œ ì„œë²„ ì¬ì‹œì‘
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `/api/fit/stream` í˜¸ì¶œ í…ŒìŠ¤íŠ¸
- [ ] ì‹¤ì‹œê°„ ë¹„ë””ì˜¤ì— ì˜·ì´ ì˜¤ë²„ë ˆì´ë˜ëŠ”ì§€ í™•ì¸

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

- **ì²˜ìŒ ì‹¤í–‰ ì‹œ**: rembgê°€ AI ëª¨ë¸ì„ ìë™ ë‹¤ìš´ë¡œë“œ (1-2ë¶„ ì†Œìš”)
- **ì˜· ì´ë¯¸ì§€**: ì •ë©´ì—ì„œ ì´¬ì˜ëœ ì˜· ì´ë¯¸ì§€ê°€ ê°€ì¥ ì˜ ì‘ë™
- **ì¡°ëª…**: ë°ì€ í™˜ê²½ì—ì„œ í¬ì¦ˆ ê°ì§€ ì •í™•ë„ í–¥ìƒ
- **ê±°ë¦¬**: ì¹´ë©”ë¼ì—ì„œ 1-2ë¯¸í„° ê±°ë¦¬ ê¶Œì¥
